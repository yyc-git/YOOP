/*!
 YOOP
 Javascript OOP framework

 version:1.1.0
 author:YYC
 email:395976266@qq.com
 qq:395976266
 blog:http://www.cnblogs.com/chaogex/
 homepage:https://github.com/yyc-git/YOOP
 repository:git@github.com:yyc-git/YOOP.git
 license:MIT
 date:2013-06-09
*/
!function(){function a(a,b){var c="";return a[b]?(c="_"+b,arguments.callee(a,c)):b}function b(a,b){var c=null,d=0,e=Object.prototype.toString,f="[object Array]",g="[object Object]",h="",i=null;if(e.call(a)===f)for(i=b||[],c=0,d=a.length;d>c;c++)h=e.call(a[c]),h===f||h===g?(i[c]=h===f?[]:{},arguments.callee(a[c],i[c])):i[c]=a[c];else if(e.call(a)===g){i=b||{};for(c in a)c.contain("baseClass")?i[c]=a[c]:(h=e.call(a[c]),h===f||h===g?(i[c]=h===f?[]:{},arguments.callee(a[c],i[c])):i[c]=a[c])}else i=a;return i}function c(a,b){var c="";for(c in b)a[c]=b[c];return a}function d(a){var b="";return a?(b=a.toString().match(/^.*function\s*([^\(]*)/),null===b?b:b[1]):null}function e(a){return"[object Array]"===Object.prototype.toString.call(a)}function f(a){a.yoop_parents=[]}function g(a,b,c){if(b){a.yoop_parents=a.yoop_parents.concat(b);for(var d=0,e=b.length;e>d;d++)a.yoop_parents=a.yoop_parents.concat(b[d].yoop_parents)}c&&(a.yoop_parents.push(c),a.yoop_parents=a.yoop_parents.concat(c.yoop_parents))}var h="1.1",i=this,j={};!function(){String.prototype.contain=function(a){var b=new RegExp(a);return this.match(b)?!0:!1}}(),function(){function a(){function a(){}function c(b,c,d){h(b)?(i(b),n.parent=e(b)?b:[b],c&&!e(c)?(n.method=Array.prototype.slice.call(arguments,1),n.attribute=null):(n.method=c,n.attribute=d)):(n.parent=null,b&&!e(b)?(n.method=Array.prototype.slice.call(arguments,0),n.attribute=null):(n.method=arguments[0],n.attribute=arguments[1])),g(a,n.parent),j()}function h(a){return"function"==typeof a||e(a)&&"function"==typeof a[0]}function i(a){var b=0,c=0;for(b=0,c=a.length;c>b;b++)if("I"!==d(a[b]))throw new Error("Interface must inherit interface!")}function j(){if(!n.method)throw new Error("Interface must has methods")}function k(){var c=0,d=0;for(c=0,d=n.parent.length;d>c;c++)b(n.parent[c].prototype,a.prototype);a.prototype.constructor=a}function l(){var b=0,c=0;for(b=0,c=n.method.length;c>b;b++)void 0!==n.method[b]&&(a.prototype["Interface_"+n.method[b]]=function(){throw new Error("This method must be overwrited!")})}function m(){var b=0,c=0;if(n.attribute){if(!e(n.attribute))throw new Error("Attribute must be array!");for(b=0,c=n.method.length;c>b;b++)a.prototype["Interface_"+n.attribute[b]]=0}}var n=this;this.parent=null,this.method=null,this.attribute=null,f(a),this.buildInterface=function(b,d,e){return c(b,d,e),this.parent&&k(),l(),m(),a}}j.Interface=function(b,c,d){return(new a).buildInterface(b,c,d)}}(),function(){function c(){}function i(){function a(){}function c(b){var c=b[0],d=b[1];if(h(b),void 0===d)l.prop=c,l.parentClass=null,l.interface=null;else if("object"==typeof c){if(!c.Class&&!c.Interface)throw new Error("Please add AbstractClass or Interface!");l.parentClass=c.Class,e(c.Interface)?l.interface=c.Interface:"function"==typeof c.Interface&&(l.interface=[c.Interface]),l.prop=d}else{if("function"!=typeof c)throw new Error("arguments is not allowed!");l.parentClass=c,l.interface=null,l.prop=d}if(i())throw new Error("AbstractClass can't inherit class!");g(a,l.interface,l.parentClass)}function h(a){if(a.length>=3)throw new Error("AbstractClass can only inherit from one parentClass");if(a[0].Class&&e(a[0].Class)&&a[0].Class.length>=2)throw new Error("AbstractClass can only inherit from one parentClass")}function i(){return"F"===d(l.parentClass)}function j(){l.prop.Abstract&&l.P_addAbstract(l.prop.Abstract)}function k(){l.prop.Virtual&&l.P_addVirtualAndCheck(l.prop.Virtual)}var l=this;this.P_class=a,this.implementaionMap={},this.parentClass=null,this.interface=null,this.prop=null,f(a),this.P_inheritInterface=function(){if(this.interface){var c=0,d=0;for(c=0,d=this.interface.length;d>c;c++)b(this.interface[c].prototype,a.prototype)}},this.P_addSpecial=function(a,b){return"Abstract"===b?(this.P_addAbstract(this.prop[a][b]),"continue"):"Virtual"===b?(this.P_addVirtualAndCheck(this.prop[a][b]),"continue"):null},this.buildAClass=function(b){return c(b),this.P_inherit(),this.P_inheritInterface(),this.P_addInit(),this.P_addPrivateMember(),this.P_addProtectedMember(),this.P_addPublicMember(),this.P_addStaticMember(),j(),k(),this.P_prepareCheck(),a}}function k(){function a(){function c(){var c=null,d=null,e=Object.prototype.toString;for(c in a.prototype)if(a.prototype.hasOwnProperty(c)){if(d=a.prototype[c],"[object Function]"===e.call(d))continue;g[c]=b(d)}g.baseClass&&(g.baseClass.constructor=a.prototype.baseClass.constructor)}function d(){l.initializing||g.Init&&g.Init.apply(g,h)}function e(a){for(var b=0,c="baseClass";a[c];)b+=1,c="_"+c;return b+1}function f(a){var b=e(g),a=a||0,c=0,d=b-1-a,f="baseClass";if(0>=d)throw new Error("没有找到baseClass");for(c=0;d-1>c;c++)f="_"+f;return g[f]}var g=this,h=arguments;c(),d(),this.isInstanceOf=function(b){var c=0,d=a.yoop_parents.length;for(c=0;d>c;c++)if(a.yoop_parents[c]===b)return!0;return this instanceof b},this.stubParentMethod=function(a,b,c){2===arguments.length?a.stub(f(0).constructor.prototype,b):3===arguments.length&&a.stub(f(0).constructor.prototype,b,c),this.lastBaseClassForTest=f(0).constructor.prototype},this.stubParentMethodByAClass=function(a,b,c){2===arguments.length?a.stub(f(1).constructor.prototype,b):3===arguments.length&&a.stub(f(1).constructor.prototype,b,c),this.lastBaseClassForTest=f(1).constructor.prototype}}function c(b){var c=b[0],f=b[1];if(d(b),void 0===f)l.prop=c,l.parentClass=null,l.interface=null;else if("object"==typeof c){if(!c.Class&&!c.Interface)throw new Error("Please add Class or Interface!");l.parentClass=c.Class,e(c.Interface)?l.interface=c.Interface:"function"==typeof c.Interface&&(l.interface=[c.Interface]),l.prop=f}else{if("function"!=typeof c)throw new Error("arguments is not allowed!");l.parentClass=c,l.interface=null,l.prop=f}g(a,l.interface,l.parentClass)}function d(a){if(a.length>=3)throw new Error("class can only inherit from one parentClass");if(a[0].Class&&e(a[0].Class)&&a[0].Class.length>=2)throw new Error("class can only inherit from one parentClass")}function h(){if(a.prototype._inheritedInterfaces=[],l.interface){var b=0,c=0;for(b=0,c=l.interface.length;c>b;b++)l.P_checkImplementationOfInterface(l.interface[b]),a.prototype._inheritedInterfaces.push(l.interface[b])}if(i()){l.P_checkImplementationOfInterface(l.parentClass);for(var d in l.parentClass.prototype)d.contain("Interface_")&&a.prototype._inheritedInterfaces.push(l.parentClass.prototype[d])}}function i(){var b="";for(b in a.prototype)if(b.contain("Interface_"))return!0;return!1}function j(){if(l.prop.Abstract)throw new Error("class can't have abstract members!")}function k(){l.prop.Virtual&&l.P_addVirtualAndCheck(l.prop.Virtual)}var l=this;this.implementaionMap={},this.parentClass=null,this.interface=null,this.prop=null,this.P_class=a,this.initializing=!1,f(a),this.P_addSpecial=function(a,b){if("Abstract"===b)throw new Error("class can't have abstract members");return"Virtual"===b?(this.P_addVirtualAndCheck(this.prop[a][b]),"continue"):null},this.buildClass=function(b){return c(b),this.parentClass&&(this.initializint=!0,this.P_inherit(),this.initializing=!1),this.P_addInit(),this.P_addPrivateMember(),this.P_addProtectedMember(),this.P_addPublicMember(),this.P_addStaticMember(),j(),k(),this.P_prepareCheck(),this.P_checkImplementationOfAbstract(),h(),a}}c.prototype=function(){return{_addMemberAndSetBaseFunc:function(a,b){var c=this.parentClass,d=this.prop,e=this.P_class,f=null;e.prototype[a]=c&&"function"==typeof d[b][a]&&"function"==typeof e.prototype[a]?function(a){return function(){return f=this.base,this.base=c.prototype[a],function(a,c,e,f){var g=d[b][f].apply(c,e);return c.base=a,g}(f,this,arguments,a)}}(a):d[b][a]},_addToImplementMap:function(a,b){this.implementaionMap[a]=b},_prepareCheckFor:function(a){var b=null;if(a)for(b in a)a.hasOwnProperty(b)&&(this._prepareCheckForSpecial(b,a),this._addToImplementMap(b,a[b]))},_prepareCheckForSpecial:function(a,b){this._addVirtualToImplementMap(a,b)},_addVirtualToImplementMap:function(a,b){var c="";if("Virtual"===a)for(c in b[a])b[a].hasOwnProperty(c)&&this._addToImplementMap(c,b[a][c])},P_checkImplementationOfAbstract:function(){var a="",b=this.parentClass;if(this.parentClass)for(a in b.prototype)"constructor"!==a&&a.contain("Abstract_")&&("function"==typeof b.prototype[a]?this._checkAbstractMethod(a):this._checkAbstractAttribute(a))},_checkAbstractMethod:function(a){var b=this.parentClass,c=this.implementaionMap;if(this._noMethodForAbstract(c,a)&&this._noMethodForAbstract(b.prototype,a))throw new Error("Abstract method '"+a+"' must be overwrited!")},_checkAbstractAttribute:function(a){var b=this.parentClass,c=this.implementaionMap;if(this._noAttritubeForAbstract(c,a)&&this._noAttritubeForAbstract(b.prototype,a))throw new Error("Abstract attribute '"+a+"' must be overwrited!")},P_checkImplementationOfInterface:function(a){var b="";for(b in a.prototype)b.contain("Interface_")&&("function"==typeof a.prototype[b]?this._checkInterfaceMethod(b):this._checkInterfaceAttribute(b))},_checkInterfaceMethod:function(a){var b=this.implementaionMap,c=this.parentClass?this.parentClass.prototype:{};if(this._noMethodForInterface(b,a)&&this._noMethodForInterface(c,a))throw new Error("Interface method '"+a+"' must be overwrited!")},_checkInterfaceAttribute:function(a){var b=this.implementaionMap,c=this.parentClass?this.parentClass.prototype:{};if(this._noAttritubeForInterface(b,a)&&this._noAttritubeForInterface(c,a))throw new Error("Interface attribute '"+a+"' must be overwrited!")},_noMethodForAbstract:function(a,b){return void 0===a[b.slice(9)]||"function"!=typeof a[b.slice(9)]},_noAttritubeForAbstract:function(a,b){return void 0===a[b.slice(9)]||"function"==typeof a[b.slice(9)]},_noMethodForInterface:function(a,b){return void 0===a[b.slice(10)]||"function"!=typeof a[b.slice(10)]},_noAttritubeForInterface:function(a,b){return void 0===a[b.slice(10)]||"function"==typeof a[b.slice(10)]},P_addAbstract:function(a){var b="",c=this.P_class;for(b in a)a.hasOwnProperty(b)&&(c.prototype["Abstract_"+b]=a[b])},P_addVirtualAndCheck:function(a){var b="",c=this.P_class;for(b in a)a.hasOwnProperty(b)&&(c.prototype[b]=a[b])},P_addStaticMember:function(){var a=null,b=null,c=this.P_class,d=this.prop;a=d.Static?d.Static:null;for(b in a)c[b]=a[b]},P_inherit:function(){var c=this.P_class,d=this.parentClass;d&&(c.prototype=b(d.prototype),c.prototype.constructor=c,c.prototype[a(d.prototype,"baseClass")]=d.prototype)},P_addInit:function(){var a=this.P_class,b=this.parentClass,c=this.prop;c.Init&&(a.prototype.Init=b&&"function"==typeof c.Init&&"function"==typeof a.prototype.Init?function(a){return function(){return this.base=b.prototype[a],c[a].apply(this,arguments)}}("Init"):c.Init)},P_addPrivateMember:function(){var a=null,b=this.P_class,c=this.prop.Private;if(c)for(a in c)c.hasOwnProperty(a)&&(b.prototype[a]=c[a])},P_addPublicMember:function(){var a=null;if(this.prop.Public)for(a in this.prop.Public)if(this.prop.Public.hasOwnProperty(a)){if("continue"===this.P_addSpecial("Public",a))continue;this._addPublic(a)}},_addPublic:function(a){this._addMemberAndSetBaseFunc(a,"Public")},P_prepareCheck:function(){this._prepareCheckFor(this.prop.Public),this._prepareCheckFor(this.prop.Protected)},P_addProtectedMember:function(){{var a=null;this.parentClass,this.prop,this.P_class}if(this.prop.Protected)for(a in this.prop.Protected)if(this.prop.Protected.hasOwnProperty(a)){if("continue"===this.P_addSpecial("Protected",a))continue;this._addMemberAndSetBaseFunc(a,"Protected")}}}}(),i.prototype=new c,k.prototype=new c,j.AClass=function(){return(new i).buildAClass(arguments)},j.Class=function(){return(new k).buildClass(arguments)},j.YOOP={version:h}}();var k="function"==typeof define,l="undefined"!=typeof module&&module.exports;k||l?k?define(function(){return j}):l&&(module.exports=j):(i.YYC=i.YYC||{},c(i.YYC,j))}();